"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(require("axios"));module.exports=(t,{services:n,exceptions:a,logger:r,getSchema:u,env:c})=>{const{ItemsService:s,MetaService:l}=n;t.get("/",((t,e)=>e.send("Hello, World!"))),t.get("/updateCurrentUser",(async(t,n,a)=>{try{let{sorare_token:a}=t.query,r=await e.default(c.SORARE_API_URL,{method:"POST",headers:{"Content-type":"application/json",Authorization:`Bearer ${a}`,APIKEY:c.SORARE_API_KEY},data:{query:"\n\t\t\t\t\t\t\tquery {\n\t\t\t\t\t\t\t\tcurrentUser {\n\t\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t\t\tnickname\n\t\t\t\t\t\t\t\t\tprofile {\n\t\t\t\t\t\t\t\t\tpictureUrl\n\t\t\t\t\t\t\t\t\tclubName\n\t\t\t\t\t\t\t\t\tclubShield {\n\t\t\t\t\t\t\t\t\t\tpictureUrl\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcardsCount\n\t\t\t\t\t\t\t\t\t\tcardCounts {\n\t\t\t\t\t\t\t\t\t\tcommon\n\t\t\t\t\t\t\t\t\t\tlimited\n\t\t\t\t\t\t\t\t\t\trare  \n\t\t\t\t\t\t\t\t\t\tsuperRare\n\t\t\t\t\t\t\t\t\t\tunique\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfavoritePlayers {\n\t\t\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t\t\t\tactiveClub {\n\t\t\t\t\t\t\t\t\t\t\tdomesticLeague {\n\t\t\t\t\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t"}}).then((t=>t.data.data.currentUser)).catch((t=>null));const l=new s("users",{schema:await u()});let i=await l.upsertOne({id:r.id,nickname:r.nickname,slug:r.slug,pictureUrl:r.profile.pictureUrl||"",clubname:r.profile.clubName||"",cards_count:r.cardsCount-r.cardCounts.common,favorites:r.favoritePlayers.map((t=>({player_slug:t.slug,club_slug:t.activeClub?.domesticLeague?.slug}))),cards_synced:!1}),d=await l.readOne(i,{fields:["id","date_updated","nickname","pictureUrl","clubname","squad","slug","cards_count","karma_score"]});return n.json(d)}catch(t){n.json(null)}})),t.get("/updateUser",(async(t,n,a)=>{try{let{slug:a}=t.query,r=await e.default(SORARE_API_URL,{method:"POST",headers:{"Content-type":"application/json"},data:{query:`\n\t\t\t\t\t\tquery {\n\t\t\t\t\t\t\tuser(slug: "${a}") {\n\t\t\t\t\t\t\t\tslug\n\t\t\t\t\t\t\t\tid\n\t\t\t\t\t\t\t\tnickname\n\t\t\t\t\t\t\t\tprofile {\n\t\t\t\t\t\t\t\t  pictureUrl\n\t\t\t\t\t\t\t\t  clubName\n\t\t\t\t\t\t\t\t  clubShield {\n\t\t\t\t\t\t\t\t\tpictureUrl\n\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcardsCount\n\t\t\t\t\t\t\t\tcardCounts {\n\t\t\t\t\t\t\t\t\tcommon\n\t\t\t\t\t\t\t\t\tlimited\n\t\t\t\t\t\t\t\t\trare  \n\t\t\t\t\t\t\t\t\tsuperRare\n\t\t\t\t\t\t\t\t\tunique\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t`}}).then((t=>t.data.data.user)).catch((t=>null));const c=new s("users",{schema:await u()});let l=await c.upsertOne({id:r.id,nickname:r.nickname,slug:r.slug,pictureUrl:r.profile.pictureUrl||"",clubname:r.profile.clubName||"",cards_count:r.cardsCount-r.cardCounts.common,cards_synced:!1}),i=await c.readOne(l,{fields:["id","date_updated","nickname","pictureUrl","clubname","squad","slug","cards_count","cards_synced","karma_score"]});return n.json(i)}catch(t){n.json(null)}}))};
